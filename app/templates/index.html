<!-- app/templates/index.html -->
<!--
 Page affichant un mot de bienvenue avec le nom de l'utilisateur
 Paramètres :
title : Titre de la page
-->
{% extends "base.html" %}
<!-- On définit le contenu du block -->
{% block contenu %}
 <!-- Ici, on se concentre uniquement sur le contenu de la page -->
<div class="w3-container w3-center w3-blue log">
    <h1>{{title}}</h1>
    <h1>Bonjour {{ current_user.username }}</h1>
    </div>
{% if form %}
<div class="w3-container log">
<h1 style="text-align: center">Enregistrer un post </h1>
</div>
<div class="w3-center w3-animate-top">
<form action="" method="POST" id="message" class="w3-container w3-center">
    {{ form.hidden_tag() }}
    <p>
        {{ form.post.label }} <br/>
        {{ form.post}}
        {% for error in form.post.errors %}
            <pan>{{ error }}</pan>
        {% endfor %}
    </p>
    <div id="drop_zone">
        <img id="id_drop_image" alt="Déposez une image ici" width="{{size}}" height="{{size/2}}">
    </div>
            <button type="button" id="deleteBtn" style="display: none;cursor: pointer" onclick="deleteImage()"><span class="material-symbols-outlined" style="color: #ff2400">
delete
</span></button>
    <p>
        {{ form.submit() }}
    </p>
    <script>
        let image = null;
window.addEventListener("load", init_drop_operation);
function init_drop_operation() {
 // On récupère l’objet image (<img>) car on va s’en servir souvent…
 image = document.querySelector("img#id_drop_image");
 const drop_zone = document.getElementById("drop_zone") ;
 drop_zone.addEventListener("drop", dropHandler);
 drop_zone.addEventListener("dragover", dragOverHandler);
}
        function dropHandler(ev) {
         console.log('File(s) dropped');
         ev.preventDefault();
         [...ev.dataTransfer.files].forEach((file, i) => {
         let image=document.getElementById("id_drop_image");
         image.src=URL.createObjectURL(file)
         image.decode().then( () => {
             if (image.naturalWidth>400)
             {
                  image.width = 400
                  image.removeAttribute("height");
             }
             else if (image.naturalHeight>400)
             {
                 image.height = 400
                 image.removeAttribute('width')
             }
             document.getElementById('deleteBtn').style.display='block';

         })
         .catch( (encodingError) => {
             console.log(encodingError)
         window.alert('Format  invalide')
         });
        })}
        function dragOverHandler(ev) {
         console.log('File(s) in drop zone');
         ev.preventDefault();
        }
        function deleteImage()
        {
            document.getElementById("id_drop_image").src=null;
             document.getElementById('deleteBtn').style.display='none';

        }
</script>
</form>
</div>
{% endif %}
<div class="w3-container w3-center">
{% for post in posts %}
    <div class="w3-container">
             <p>
                {% include "_post.html" %}
             </p>
    <div>
         {% else %}

     </div>
             <p>
                Il n'y a pas encore de message posté.
             </p>
         </div>
 {% endfor %}
    <div>
 {% if prev_url %}
     <a href="{{ prev_url }}"><span class="material-symbols-outlined">
navigate_before
</span></a>
 {% endif %}
 {% if next_url %}
     <a href="{{ next_url }}"><span class="material-symbols-outlined">
navigate_next
</span></a>
 {% endif %}
 </div>
</div>
{% endblock %}